<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="style.css" />
    <title>Voice Input PWA</title>
  </head>
  <body>
    <h1>Voice Input PWA</h1>
    <button id="mic-button">Press to speak</button>
  </body>
  <script>
      const micButton = document.getElementById('mic-button');
      micButton.addEventListener('click', startVoiceRecognition);
    
      function startVoiceRecognition() {
            const recognition = new webkitSpeechRecognition();
            recognition.onresult = function (event) {
                const transcript = event.results[0][0].transcript;
                console.log(transcript);
                const output = document.createElement('p');
                output.textContent = transcript;
                document.body.appendChild(output);


                // Synthesize speech from the text
                const synth = window.speechSynthesis;
                const speakText = new SpeechSynthesisUtterance(transcript);

                // Get a list of available voices
                const voices = synth.getVoices();
                // Set the voice to the first available female voice
                speakText.voice = voices.find(voice => voice.gender === 'female');

                speakText.rate = 0.9;
              
                synth.speak(speakText);
            };
            recognition.start();
      }
      function completeText(text) {
        const model = 'davinci';
        const url = `https://api.openai.com/v1/completions?model=${model}&prompt=${text}&max_tokens=2048&top_p=1&n=1&stop=.&echo=0&presence_penalty=0`;

        return new Promise((resolve, reject) => {
          const xhr = new XMLHttpRequest();
          xhr.open('POST', url);
          xhr.setRequestHeader('Content-Type', 'application/json');
          xhr.setRequestHeader('Authorization', `Bearer ${API_KEY}`);
          xhr.onload = () => {
            if (xhr.status >= 200 && xhr.status < 300) {
              const data = JSON.parse(xhr.responseText);
              resolve(data.choices[0].text);
            } else {
              reject(Error(xhr.statusText));
            }
          };
          xhr.onerror = () => reject(Error('Network Error'));
          xhr.send();
        });
      }

  </script>
</html>
